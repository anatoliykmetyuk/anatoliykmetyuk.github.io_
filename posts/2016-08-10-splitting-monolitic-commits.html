<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MGZJP4K');</script>
<!-- End Google Tag Manager -->

  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Anatolii Kmetiuk - How to split monolithic commit history in git</title>
<meta name="author" content="Anatolii Kmetiuk" />

<meta name="description" content="The blog of Anatolii Kmetiuk">
<meta name="keywords" content="scala,programming,functional programming,category theory,kmetiuk,kmetyuk,anatolii kmetiuk,anatoliy kmetyuk">

<!-- Facebook tags -->
<meta property="og:title" content="How to split monolithic commit history in git">
<meta property="og:type" content="article">
<meta property="og:url" content="http://akmetiuk.com/posts/2016-08-10-splitting-monolitic-commits.html">
<meta property="og:image" content="http://akmetiuk.com/assets/imgs/avatar_100.png">
<meta property="og:description" content="The blog of Anatolii Kmetiuk">
<meta property="og:site_name" content="The blog of Anatolii Kmetiuk">
<meta property="og:locale" content="en-GB">

<!-- Twitter tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="The blog of Anatolii Kmetiuk" />
<meta name="twitter:title" content="How to split monolithic commit history in git" />
<meta name="twitter:site" content="@AKmetyuk" />
<meta name="twitter:image" content="http://akmetiuk.com/assets/imgs/avatar_100.png" />
<meta name="twitter:creator" content="@AKmetyuk" />

  <link rel="canonical" href="http://akmetiuk.com/posts/2016-08-10-splitting-monolitic-commits.html" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Anatolii Kmetiuk" href="http://akmetiuk.com/atom.xml" />

  <link rel="stylesheet" href="/assets/all.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MGZJP4K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us15.list-manage.com","uuid":"01ce16a4527151a8b35030c4d","lid":"b3fb931294"}) })</script>

  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1>Hi.</h1>
  <a href="/">
    <img src="/assets/imgs/avatar_200.png" id="logo" alt="Blog logo"/>
  </a>
  <h2>I'm <a href="/">Anatolii Kmetiuk</a>.</h2>
  <div id="bio">
    <p>ğŸ‘¨ğŸ¼â€ğŸ’»Functional Programming Freelancer. I implement web applications and other solutions in a purely functional way in Scala. I also provide mentorship services to help you implement your Scala projects or learn some functional programming. I write here about my work and my discoveries along the life journey.</p>
    <p>ğŸ“•Check out <a href="https://www.amazon.com/Mastering-Functional-Programming-techniques-programming/dp/1788620798/">"Mastering Functional Programming"</a>, my latest book on purely functional programming in Scala with ğŸ˜¸<a href="https://typelevel.org/cats/">Cats</a> and the <a href="https://typelevel.org/">Typelevel</a> family of libraries.</p>
    <p>ğŸ“¬Whether you are interested in working with me or just want to chat casually and get to know me better, you are always welcome to contact me. <a href="javascript:location='mailto:\u0061\u006e\u0061\u0074\u006f\u006c\u0069\u0069\u0040\u0066\u0075\u006e\u0063\u0074\u006f\u0072\u0074\u0065\u0063\u0068\u002e\u0063\u006f\u006d';void 0">âœ‰ï¸Shoot me a message</a> or <a href="https://calendly.com/anatoliykmetyuk/collaboration">ğŸ“schedule a call</a>, and let's see where it takes us.</p>
    <p>ğŸ’¡Some cool stuff I am working on:
      <ul style="list-style: none;">
        <li>âœ”ï¸<a href="https://functorhub.com/">FunctorHub.com</a> â€“ my courses and books on purely functional Scala.</li>
        <li>âœ”ï¸<a href="https://github.com/anatoliykmetyuk/thera">Thera</a> â€“ a static website generator for Scala. This blog was generated with Thera!</li>
        <li>âœ”ï¸<a href="https://www.packtpub.com/books/info/authors/anatolii-kmetiuk">Packt</a> â€“ more courses and books of mine.</li>
      </ul>
    </p>
  </div>
  <div id="social">
    Follow me:
    <div id="stalker">
      <a title="anatoliykmetyuk on Github" href="https://github.com/anatoliykmetyuk">
        <i class="fa fa-github-square"></i>
      </a>

      <a title="AKmetyuk on Twitter" href="https://twitter.com/AKmetyuk">
        <i class="fa fa-twitter-square"></i>
      </a>

      <a title="Anatolii Kmetiuk on LinkedIn" href="https://www.linkedin.com/in/anatoliykmetyuk">
        <i class="fa fa-linkedin-square"></i>
      </a>
    </div>
  </div>
</nav>
    </div>

    <div class="eleven columns content">
      <p class="meta">
Aug 10, 2016 <a href="/"> <i class="home fa fa-home"></i> </a>
</p>
<h1 class="title">
How to split monolithic commit history in git
</h1>
<div id="post">
<div class="toc">
<ul>
<li>
<a href="#problem">Problem</a>
</li>
<li>
<a href="#solution">Solution</a>
</li>
</ul>
</div>
<div class="body">
<h1 id="problem">
Problem
</h1>
<p>
Suppose you have a fork of some GitHub repository. You have made some changes in it that fix multiple bugs and add some new features. Now you want to send your work to the main repository.
</p>
<p>
If you send your work as a single pull request, it may be hard to process for the core team, since it spans multiple issues and multiple features are added. Moreover, the core team may have its own opinions regarding which features are needed and which not; they may want to partially accept your work.
</p>
<p>
It is better to split the work into multiple pull requests. But what to do if your commits are highly monolithic? That is, commits for issue A, followed by commits for issue B, then some commits for A again, and then some for B again?
</p>
<p>
How to restructure your work, so that it can be sent in separate, modular pull requests?
</p>
<h1 id="solution">
Solution
</h1>
<p>
The idea is to make several branches, each one containing commits related to a single particular issue. Moreover, since the commits may be monolithic, we will restructure them.
</p>
<p>
First, we will bring our local repository to the state of the upstream we're going to send pull requests to. Then, we will create the branches, one for each issue we solved. Finally, to each branch we will apply the entire diff between it and our master with our work (effectively bringing it to the state of our master) and hand-pick the changes to commit for a given issue.
</p>
<p>
Assuming there's a remote to the main repository named <code>upstream</code> in your local repository, your own work is in the <code>master</code> branch of your local repository and you want to send pull requests to <code>upstream/master</code>, here is how to do that:
</p>
<ol style="list-style-type: decimal">
<li>
Get your local repo to the state of the upstream repo: <code>git fetch upstream &amp;&amp; git checkout upstream/master</code>.
</li>
<li>
Create a branch for the first issue: <code>git checkout -b issue1</code>
</li>
<li>
Calculate the diff between <code>issue1</code> and <code>master</code> (assuming <code>master</code> contains your work) and apply it to the current branch: <code>git diff head master | git apply</code>
</li>
<li>
Now stage only the changes related to issue1 using <a href="https://git-scm.com/book/en/v2/Git-Tools-Interactive-Staging">interactive stage</a>: <code>git add -i</code>. Use the interactive menu to select which files and hunks to stage.
</li>
<li>
Commit the changes: <code>git commit</code>
</li>
<li>
Clean up the work directory from the changes you didn't need: <code>git clean -f; git reset --hard</code>
</li>
<li>
If you forgot to add some changes to the issue1 branch, go to step (3)
</li>
</ol>
</div>
</div>
<div id="spread">
<!-- Twitter --> <a class="twitter-share-button"
    href="https://twitter.com/intent/tweet?text=How to split monolithic commit history in git"
    data-size="large">
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
Tweet</a> <a href="https://twitter.com/AKmetyuk" class="twitter-follow-button" data-show-count="false" data-size="large">Follow <span class="citation">@AKmetyuk</span></a>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<div id="disqus_thread">

</div>
<script>
var disqus_config = function () {
this.page.url = 'http://akmetiuk.com/posts/2016-08-10-splitting-monolitic-commits.html';
this.page.identifier = '/posts/2016-08-10-splitting-monolitic-commits.html';
};

(function() {
var d = document, s = d.createElement('script');

s.src = '//anatoliikmetiukblog.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>


      <div class="footer">
        <div class="disclaimer">
  <p>
    Â© Anatolii Kmetiuk, 2016 &mdash; built using <a href="https://github.com/swanson/lagom">Lagom theme</a>. Powered by <a href="https://github.com/anatoliykmetyuk/thera">Thera</a>. The sources of this site are availabel on <a href="https://github.com/anatoliykmetyuk/anatoliykmetyuk.github.io">GitHub</a>.
  </p>
</div>
      </div>
    </div>
  </div>
</body>
</html>